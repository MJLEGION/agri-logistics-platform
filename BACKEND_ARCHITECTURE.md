# Backend Integration Architecture

## ğŸ—ï¸ System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND (React Native + Expo)                   â”‚
â”‚                     Port: 8082 (Web Development)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ HTTP/HTTPS
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Axios API Client        â”‚
                    â”‚  (src/services/api.ts)    â”‚
                    â”‚                            â”‚
                    â”‚  - Request Interceptors   â”‚
                    â”‚  - Token Authorization    â”‚
                    â”‚  - Error Handling         â”‚
                    â”‚  - Timeout Management     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ Bearer Token in Headers
                                  â”‚ Content-Type: application/json
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BACKEND (Node.js + Express + MongoDB)                  â”‚
â”‚                    Port: 5000 (/api endpoint)                       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Authentication Routes                     â”‚   â”‚
â”‚  â”‚  POST   /auth/register   - Create new user                â”‚   â”‚
â”‚  â”‚  POST   /auth/login      - Authenticate user              â”‚   â”‚
â”‚  â”‚  POST   /auth/logout     - End session                    â”‚   â”‚
â”‚  â”‚  GET    /auth/me         - Get current user               â”‚   â”‚
â”‚  â”‚  POST   /auth/refresh    - Refresh JWT token              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Crops/Products Routes                     â”‚   â”‚
â”‚  â”‚  GET    /crops           - List all crops                  â”‚   â”‚
â”‚  â”‚  GET    /crops/:id       - Get single crop                â”‚   â”‚
â”‚  â”‚  POST   /crops           - Create new crop                â”‚   â”‚
â”‚  â”‚  PUT    /crops/:id       - Update crop                    â”‚   â”‚
â”‚  â”‚  DELETE /crops/:id       - Delete crop                    â”‚   â”‚
â”‚  â”‚  GET    /crops/user/:id  - Get user's crops               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Orders Routes                             â”‚   â”‚
â”‚  â”‚  GET    /orders          - List all orders                 â”‚   â”‚
â”‚  â”‚  GET    /orders/:id      - Get order details               â”‚   â”‚
â”‚  â”‚  POST   /orders          - Create new order                â”‚   â”‚
â”‚  â”‚  PUT    /orders/:id      - Update order                    â”‚   â”‚
â”‚  â”‚  DELETE /orders/:id      - Delete order                    â”‚   â”‚
â”‚  â”‚  GET    /orders/user/:id - Get user's orders               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Transporters Routes                       â”‚   â”‚
â”‚  â”‚  GET    /transporters            - List all transporters   â”‚   â”‚
â”‚  â”‚  GET    /transporters/:id        - Get transporter details â”‚   â”‚
â”‚  â”‚  GET    /transporters/available  - Get available ones      â”‚   â”‚
â”‚  â”‚  PUT    /transporters/:id        - Update profile          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Payments Routes                           â”‚   â”‚
â”‚  â”‚  POST   /payments/initiate       - Start payment           â”‚   â”‚
â”‚  â”‚  GET    /payments/:id            - Check status            â”‚   â”‚
â”‚  â”‚  POST   /payments/confirm        - Confirm payment         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              MongoDB Database (Persistence)                 â”‚   â”‚
â”‚  â”‚  - Users Collection                                         â”‚   â”‚
â”‚  â”‚  - Crops Collection                                         â”‚   â”‚
â”‚  â”‚  - Orders Collection                                        â”‚   â”‚
â”‚  â”‚  - Transporters Collection                                  â”‚   â”‚
â”‚  â”‚  - Payments Collection                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Flow Diagram

### 1. Authentication Flow

```
User enters credentials
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component (LoginScreen.tsx)      â”‚
â”‚ - Collect email, password        â”‚
â”‚ - Dispatch login() action        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redux Thunk (authSlice.ts)       â”‚
â”‚ - login({ phone, password })     â”‚
â”‚ - Call authService.login()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service Layer (authService.ts)   â”‚
â”‚ - api.post('/auth/login', data)  â”‚
â”‚ - Handle response                â”‚
â”‚ - Store token in AsyncStorage    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Axios (api.ts)                   â”‚
â”‚ - Add Bearer token header        â”‚
â”‚ - Make HTTP request              â”‚
â”‚ - Handle interceptors            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend API                      â”‚
â”‚ POST /auth/login                 â”‚
â”‚ - Verify credentials             â”‚
â”‚ - Generate JWT token             â”‚
â”‚ - Return user data               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response (token, user data)      â”‚
â”‚ Back to Frontend                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redux Store                      â”‚
â”‚ - Save token in auth.token       â”‚
â”‚ - Save user in auth.user         â”‚
â”‚ - Set isAuthenticated = true     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component Re-renders             â”‚
â”‚ Navigation to Dashboard          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Cargo Management Flow

```
User clicks "List Cargo"
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ListCargoScreen Component        â”‚
â”‚ - Show form: name, qty, price    â”‚
â”‚ - User fills data                â”‚
â”‚ - Clicks "Create"                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redux Thunk (cargoSlice.ts)      â”‚
â”‚ - createCargo(cargoData)         â”‚
â”‚ - Call cargoService.createCargo()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service (cargoService.ts)        â”‚
â”‚ - api.post('/crops', cargoData)  â”‚
â”‚ - Backend validates and saves    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB Database                 â”‚
â”‚ Insert into crops collection     â”‚
â”‚ Return created document          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redux Store                      â”‚
â”‚ - Add new cargo to state.cargo   â”‚
â”‚ - Update UI automatically        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component Shows                  â”‚
â”‚ "Cargo created successfully!"    â”‚
â”‚ New cargo in list                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Order + Transporter Assignment Flow

```
Shipper creates order
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redux: createOrder()             â”‚
â”‚ POST /orders                     â”‚
â”‚ { crop_id, quantity, destination}
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
MongoDB: Order saved with status "pending"
        â”‚
        â–¼
Transporter views available loads
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redux: fetchOrders()             â”‚
â”‚ GET /orders                      â”‚
â”‚ Shows all pending orders         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Transporter clicks "Accept"
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redux: assignTransporter()       â”‚
â”‚ PUT /orders/:id                  â”‚
â”‚ { transporter_id, status }       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
MongoDB: Order updated
        â”‚
        â–¼
Both users notified of assignment
```

---

## ğŸ” Security Flow

```
Frontend Request
    â”‚
    â”œâ”€ Get token from AsyncStorage
    â”‚
    â”œâ”€ Add to request header:
    â”‚  Authorization: Bearer {token}
    â”‚
    â–¼
Backend Receives Request
    â”‚
    â”œâ”€ Check Authorization header
    â”‚
    â”œâ”€ Verify JWT signature
    â”‚  (Must match backend secret)
    â”‚
    â”œâ”€ Check token expiration
    â”‚
    â”œâ”€ Extract user ID from token
    â”‚
    â–¼
If Valid: Process request
    â”‚
    â”œâ”€ Return data
    â”‚
    â–¼
If Invalid: Return 401 Unauthorized
    â”‚
    â”œâ”€ Frontend detects 401
    â”‚
    â”œâ”€ Try to refresh token
    â”‚  POST /auth/refresh
    â”‚
    â”œâ”€ If refresh succeeds:
    â”‚   Save new token, retry request
    â”‚
    â”œâ”€ If refresh fails:
    â”‚   Redirect to login
    â”‚
    â–¼
User must login again
```

---

## ğŸ“¦ State Management Structure

### Redux Store Shape

```javascript
{
  auth: {
    user: {
      _id: "mongoid123",
      name: "John Farmer",
      phone: "+250700000001",
      role: "farmer"
    },
    token: "eyJhbGc...", // JWT token
    isAuthenticated: true,
    isLoading: false,
    error: null
  },

  cargo: {
    cargo: [
      {
        _id: "cargo123",
        name: "Tomatoes",
        quantity: 100,
        price: 500,
        location: "Kigali",
        userId: "user123"
      }
    ],
    isLoading: false,
    error: null
  },

  orders: {
    orders: [
      {
        _id: "order123",
        crop_id: "cargo123",
        quantity: 50,
        destination: "Kigali",
        status: "pending",
        transporter_id: null
      }
    ],
    selectedOrder: null,
    isLoading: false,
    error: null
  },

  transporters: {
    transporters: [
      {
        _id: "transporter123",
        name: "John Driver",
        vehicle_type: "truck",
        capacity: 5000,
        rates: 50000,
        available: true
      }
    ],
    availableTransporters: [...],
    selectedTransporter: null,
    isLoading: false,
    error: null
  }
}
```

---

## ğŸ”„ Component-Redux-Service Connection

### Example: Fetching Cargo List

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component: ShipperDashboardScreen.tsx              â”‚
â”‚                                                      â”‚
â”‚  useEffect(() => {                                  â”‚
â”‚    dispatch(fetchCargo());  â—„â”€â”€â”€ Dispatch action   â”‚
â”‚  }, [dispatch]);                                    â”‚
â”‚                                                      â”‚
â”‚  const { cargo, isLoading } = useSelector(          â”‚
â”‚    state => state.cargo  â—„â”€â”€â”€ Subscribe to state    â”‚
â”‚  );                                                  â”‚
â”‚                                                      â”‚
â”‚  return (                                            â”‚
â”‚    <ScrollView>                                      â”‚
â”‚      {cargo.map(item => (                            â”‚
â”‚        <CargoCard key={item._id} cargo={item} />     â”‚
â”‚      ))}                                             â”‚
â”‚    </ScrollView>                                     â”‚
â”‚  );                                                  â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ dispatch(fetchCargo())
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redux Thunk: cargoSlice.ts                         â”‚
â”‚                                                      â”‚
â”‚  export const fetchCargo = createAsyncThunk(        â”‚
â”‚    'cargo/fetchAll',                                â”‚
â”‚    async (_, { rejectWithValue }) => {              â”‚
â”‚      try {                                           â”‚
â”‚        return await cargoService.getAllCargo();     â”‚
â”‚      } catch (error) {                              â”‚
â”‚        return rejectWithValue(error);               â”‚
â”‚      }                                               â”‚
â”‚    }                                                â”‚
â”‚  );                                                 â”‚
â”‚                                                      â”‚
â”‚  // Reducers update state on success/error          â”‚
â”‚  .addCase(fetchCargo.fulfilled, (state, action) => {
â”‚    state.cargo = action.payload;                    â”‚
â”‚  })                                                  â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Call cargoService
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service: cargoService.ts                           â”‚
â”‚                                                      â”‚
â”‚  export const getAllCargo = async () => {           â”‚
â”‚    const response = await api.get('/crops');        â”‚
â”‚    return response.data;                            â”‚
â”‚  };                                                 â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ HTTP GET /crops
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend: Express Route Handler                     â”‚
â”‚                                                      â”‚
â”‚  app.get('/crops', (req, res) => {                  â”‚
â”‚    // Query MongoDB for all crops                   â”‚
â”‚    // Return as JSON array                          â”‚
â”‚  });                                                â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Response: [{ _id, name, ... }]
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Axios Response                                      â”‚
â”‚  (Automatic conversion to state via Redux)          â”‚
â”‚                                                      â”‚
â”‚  response.data = [...]                              â”‚
â”‚  â–¼                                                  â”‚
â”‚  Redux state updated                                â”‚
â”‚  â–¼                                                  â”‚
â”‚  Component re-renders with new cargo list           â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ Request/Response Cycle

### Complete Request Example

```
1. Frontend (Browser)
   POST http://localhost:5000/api/orders
   Headers:
   - Authorization: Bearer eyJhbGc...
   - Content-Type: application/json

   Body:
   {
     "crop_id": "cargo123",
     "quantity": 50,
     "destination": "Kigali",
     "delivery_date": "2025-03-15"
   }

2. Axios Interceptor (Request)
   - Add token to headers
   - Log request
   - Check timeout

3. Backend Server
   POST /api/orders

   a) Middleware checks
      - Is token valid? âœ“
      - Is user authenticated? âœ“

   b) Controller processes
      - Validate input data
      - Check user exists
      - Check crop exists

   c) Database operations
      - Insert order into orders collection
      - Update crop availability
      - Create audit log

   d) Response preparation
      status: 201 Created
      body: { _id: "order456", ...order_data }

4. Axios Interceptor (Response)
   - Log response
   - Check status code
   - Return to Redux thunk

5. Redux Thunk
   - fulfilled() called
   - Update state.orders array
   - State dispatch action

6. Component
   - Selector triggered
   - Re-render with new order in list

7. User Sees
   "Order created successfully!"
   New order appears in list
```

---

## ğŸ› Error Handling Architecture

```
Error Occurs Anywhere in Chain
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. API Request Fails               â”‚
â”‚    - Network error                 â”‚
â”‚    - Server error (5xx)            â”‚
â”‚    - Client error (4xx)            â”‚
â”‚    - Timeout                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Axios Interceptor Catches It    â”‚
â”‚    - Log error                     â”‚
â”‚    - Handle 401 (token refresh)    â”‚
â”‚    - Handle 403 (permission)       â”‚
â”‚    - Handle 500 (server error)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Redux Thunk                     â”‚
â”‚    - rejectWithValue(error)        â”‚
â”‚    - Dispatch rejected action      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Redux Reducer                   â”‚
â”‚    - addCase(action.rejected)      â”‚
â”‚    - Set state.error = message     â”‚
â”‚    - Set state.isLoading = false   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Component                       â”‚
â”‚    - useSelector(state.error)      â”‚
â”‚    - Display error message         â”‚
â”‚    - Retry button available        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. User Actions                    â”‚
â”‚    - Read error message            â”‚
â”‚    - Click retry or try again      â”‚
â”‚    - Contact support if persistent â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± Device-Specific Configurations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Platform Detection (platformUtils.ts)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Web Browser (localhost:8082)
    â”‚
    â”œâ”€ API URL: http://localhost:5000/api
    â”œâ”€ Timeout: 30 seconds
    â”œâ”€ Storage: LocalStorage
    â”‚
    â–¼
iOS/Android Physical Device
    â”‚
    â”œâ”€ API URL: http://192.168.x.x:5000/api
    â”‚  (Use machine IP instead of localhost)
    â”œâ”€ Timeout: 30 seconds
    â”œâ”€ Storage: AsyncStorage (react-native)
    â”‚
    â–¼
iOS/Android Emulator
    â”‚
    â”œâ”€ API URL: http://10.0.2.2:5000/api
    â”‚  (Special Android emulator IP)
    â”œâ”€ Timeout: 30 seconds
    â”œâ”€ Storage: AsyncStorage
    â”‚
    â–¼
Production
    â”‚
    â”œâ”€ API URL: https://api.production.com/api
    â”œâ”€ Timeout: 30 seconds
    â”œâ”€ Storage: Secured AsyncStorage
```

---

## ğŸ¯ Key Takeaways

1. **Layered Architecture**

   - UI Layer (Components)
   - State Management (Redux)
   - Service Layer (API calls)
   - Network Layer (Axios)
   - Backend (Express + MongoDB)

2. **Unidirectional Data Flow**

   - Component â†’ Redux â†’ Service â†’ API â†’ Backend â†’ Database
   - Response flows back: Database â†’ Backend â†’ API â†’ Service â†’ Redux â†’ Component

3. **Error Handling**

   - Catch at every level
   - Log for debugging
   - Present user-friendly messages

4. **Security**

   - JWT tokens in headers
   - Token refresh on expiry
   - Role-based access control

5. **State Management**
   - Redux keeps auth, cargo, orders, transporters
   - Components subscribe via selectors
   - Thunks handle async operations

---

This architecture ensures:
âœ… Scalability
âœ… Maintainability  
âœ… Testability
âœ… Security
âœ… Performance
